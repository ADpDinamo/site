{% extends "account/base.html" %}

{% load i18n %}
{% load account socialaccount %}
{% load crispy_forms_tags %}

{% block head_title %}{% trans "Sign In" %}{% endblock %}

{% block inner %}

{% if request.user.is_authenticated %}
<h4>
Salut, muie!
</h4>
{%endif%}

<form id="logare" class="login" method="POST" action="{% url 'account_login' %}">
  {% csrf_token %}
  <div class="card-body">
    <div class="form-group bmd-form-group">
        <div class="input-group">
          <div class="input-group-prepend">
            <div class="input-group-text"><i class="material-icons">face</i></div>
          </div>
          <p>Dudu
            {{form.login.errors}}</br>
            {% for error in form.login.errors %}
                <p id="error_{{ forloop.counter }}_{{ field.auto_id }}" class="invalid-feedback"><strong>{{ error }}</strong></p>
            {% endfor %}
          </p>
          <input type="text"
              name="{% if form.login.name|wordcount > 1 %}{{ form.login.name|slugify }}{% else %}{{ form.login.name }}{% endif %}"
              {% if form.login.input_type != "hidden" %}
                  class="form-control"
                  id="{{ form.login.id_for_label}}"
              {% endif %}
              {{ form.login.flat_attrs|safe }}
              />
      </div>
    </div>
    <div class="form-group bmd-form-group">
        <div class="input-group">
          <div class="input-group-prepend">
            <div class="input-group-text"><i class="material-icons">lock_outline</i></div>
          </div>
          <input type="password"
              name="{% if form.password.name|wordcount > 1 %}{{ form.password.name|slugify }}{% else %}{{ form.password.name }}{% endif %}"
              {% if form.password.input_type != "hidden" %}
                  class="form-control"
                  id="{{ form.password.id_for_label}}"
              {% endif %}
              {{ form.password.flat_attrs|safe }}
              />
      </div>
    </div>
    <p>{{form.errors}}</p>
    {% if redirect_field_value %}
    <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
    {% endif %}
    <button class="btn btn-primary btn-round" type="submit">{% trans "Sign In" %}</button>
  </div>
</form>

{% endblock %}
{% block javascript22 %}
  <script type="text/javascript">
    $(document).on('submit', '#logare', function(e){
      e.preventDefault();

      $.ajax({
        type: 'POST',
        url: '/accounts/login/',
        data:{
          login:$('#id_login').val(),
          password:$('#id_password').val(),
          csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
        },
        success:function(){
          alert("{{request.user.username}}")
        },
        error:function(data){
          console.log(data.status)
        }
      });
    });
  </script>
{% endblock %}
